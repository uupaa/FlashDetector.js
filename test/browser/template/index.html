<!DOCTYPE html><html><head><title>FlashDetector test</title>
<meta name="viewport" content="width=device-width, user-scalable=no">
<meta charset="utf-8"></head><body>

<style>
html, body { width: 100%, height: 100%; }
</style>
<script src="../../lib/WebModule.js"></script>
<script>
WebModule.VERIFY  = __WEBMODULE_VERIFY__;
WebModule.VERBOSE = __WEBMODULE_VERBOSE__;
WebModule.PUBLISH = __WEBMODULE_PUBLISH__;
</script>

__MODULES__
__WMTOOLS__
__SOURCES__

<div id="container" style="background-color:green; width:100%; height:100%"></div>
<script>
/*
window.onload = function() {
  var flash = new FlashDetector({
    swf: "../../swf/FlashDetector/bin/FlashDetector.swf",
    callback: function(flashEnabled) { // @arg Boolean
      console.log(flashEnabled === flash.enabled); // -> true
      alert(flash.enabled);
    }
  });
}
 */
// ExtenalInterface は js 側で removeChild した後にどうなるか?
// 1. DOM Tree に戻さなくてもアクセスが可能か?
// 2. DOM Tree に戻せばアクセスが可能になるか?
// 3. 完全に利用不能になるのか?
var flash = null;
window.onload = function() {
    var id = "external123";
    flash = new FlashDetector({
        id: "id",
        swf: "../../swf/FlashDetector/bin/FlashDetector.swf",
        width: "640",
        height: "320",
        timeout: 2000,
        container: document.querySelector("#container"),
        flashvars: "debug=1",
        callback: function(flashEnabled) {
            console.log("flash.enabled", flash.enabled, flashEnabled); // -> true, true
            otherUsecase();
        }
    });
};

function otherUsecase() {
    var obj = flash.flashObject;
    if (obj) {
        setTimeout(function() {
            flash.detach();
            console.log(flash.enabled, flash.enabled === false ? "ok" : "ng");
            flash.attach(document.body, function(flashEnabled) {
                console.log("re-attached. flashEnabled", flash.enabled, flashEnabled); // -> true, true
            });
        }, 3000);
    }
}

var stopTime = Date.now() + 10 * 1000;
var tid = setInterval(function() {
    if (flash && flash.enabled) {
        var result = flash.ping();
        console.log(result, result === "pong" ? "ok" : "ng");
    }
    if (Date.now() >= stopTime) {
        console.log("finished");
        clearInterval(tid);
        flash.release();
    }
}, 500);

</script>
</body></html>


